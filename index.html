<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
      #loading-indicator {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 20px;
        border-radius: 10px;
        display: none;
        font-family: Arial, sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="loading-indicator">正在加載AR體驗，請稍候...</div>

    <a-scene
      mindar-image="imageTargetSrc: https://raw.githubusercontent.com/isaoinvest/name-card/main/KKtargets.mind; warmupTolerance: 5; missTolerance: 600; filterMinCF: 0.000001; filterBeta: 500"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <img
          id="profile"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Big%20Head%20Shot.png"
          crossorigin="anonymous"
        />
        <img
          id="website"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/website.png"
          crossorigin="anonymous"
        />
        <img
          id="Email"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/EMAIL.png"
          crossorigin="anonymous"
        />
        <img
          id="phone"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/phone.png"
          crossorigin="anonymous"
        />
        <img
          id="image-LINE"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Line-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-Youtube"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Youtube-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-IG"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Instagram-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-FB"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Facebook-1.png"
          crossorigin="anonymous"
        />
        <video
          id="video1"
          src="https://pub-ac80c6d0a305452bbe0bdfcec65b6a2c.r2.dev/NEWS.mp4"
          autoplay
          loop
          muted
          playsinline
          crossorigin="anonymous"
        ></video>
        <a-asset-item
          id="raccoonModel"
          src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/band-example/raccoon/scene.gltf"
        ></a-asset-item>
      </a-assets>

      <a-camera
        position="0 0 0"
        look-controls="enabled: false"
        cursor="fuse: false; rayOrigin: mouse;"
        raycaster="far: 1000; objects: .clickable"
      ></a-camera>

      <!-- 第一個AR目標 - 名片內容 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity
          id="interaction-prompt"
          position="0 -0.5 -1"
          text="value: 點擊元素以互動; align: center; color: #FFFFFF; width: 2"
          animation="property: opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"
        ></a-entity>
        
        <a-entity
          text="value: Red Panda Keeper\nMingHsun Li; color: #FFF"
          position="1.2 0.68 -1.5"
          scale="2 2 2"
        ></a-entity>
        
        <a-gltf-model
          rotation="0 0 0"
          position="-0.25 -0.15 0"
          scale="0.09 0.09 0.09"
          src="#raccoonModel"
          animation-mixer
        ></a-gltf-model>
        
        <a-image
          src="#profile"
          width="0.55"
          height="0.55"
          position="0.6 0.9 -1.5"
          rotation="0 0 0"
        ></a-image>
        
        <a-image
          src="#website"
          width="0.65"
          height="0.25"
          position="0.6 0.4 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://isaoinvest.com"
        ></a-image>
        
        <a-image
          src="#Email"
          width="0.65"
          height="0.25"
          position="0.6 0.1 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: mailto:isaoinvest@gmail.com"
        ></a-image>
        
        <a-image
          src="#phone"
          width="0.65"
          height="0.23"
          position="0.6 -0.2 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: tel:+886920820259"
        ></a-image>
        
        <a-image
          src="#image-LINE"
          width="0.3"
          height="0.3"
          position="0.6 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://line.me/R/ti/p/@722fdkca"
        ></a-image>
        
        <a-image
          src="#image-Youtube"
          width="0.3"
          height="0.3"
          position="0.2 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.youtube.com/channel/UC7hJoQaFXoqB-tW4zACOtvQ"
        ></a-image>
        
        <a-image
          src="#image-IG"
          width="0.3"
          height="0.3"
          position="-0.2 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.instagram.com/isaoinvest"
        ></a-image>
        
        <a-image
          src="#image-FB"
          width="0.3"
          height="0.3"
          position="-0.6 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.facebook.com/profile.php?id=61552552833098"
        ></a-image>
      </a-entity>

      <!-- 第二個AR目標 - 影片 -->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-video
          src="#video1"
          height="1.05"
          width="1.5"
          position="0 0 0"
          rotation="0 0 0"
          class="clickable"
          click-handler
        ></a-video>
      </a-entity>
    </a-scene>

    <script>
      // 視頻點擊控制
      AFRAME.registerComponent("click-handler", {
        init: function () {
          var video = document.querySelector("#video1");
          var playing = false;
          
          this.el.addEventListener("click", function () {
            if (!playing) {
              video.play();
            } else {
              video.pause();
            }
            playing = !playing;
          });
        },
      });

      // 載入指示器邏輯
      const loadingIndicator = document.getElementById("loading-indicator");
      
      document.addEventListener("DOMContentLoaded", () => {
        loadingIndicator.style.display = "block";
      });

      // 等待場景完全載入
      document.querySelector("a-scene").addEventListener("loaded", () => {
        setTimeout(() => {
          loadingIndicator.style.display = "none";
        }, 1000);
      });

      // 添加錯誤處理
      window.addEventListener('error', function(e) {
        console.error('Error:', e.error);
        loadingIndicator.style.display = "none";
      });

      // MindAR 載入狀態監聽
      document.querySelector("a-scene").addEventListener("arReady", () => {
        console.log("AR is ready");
        loadingIndicator.style.display = "none";
      });

      document.querySelector("a-scene").addEventListener("arError", (event) => {
        console.error("AR Error:", event.detail);
        loadingIndicator.style.display = "none";
      });

      // 點擊元素效果
      const clickableElements = document.querySelectorAll(".clickable");
      clickableElements.forEach((element) => {
        element.addEventListener("mouseenter", () => {
          element.setAttribute("animation", "property: scale; to: 1.1 1.1 1.1; dur: 300");
        });
        element.addEventListener("mouseleave", () => {
          element.setAttribute("animation", "property: scale; to: 1 1 1; dur: 300");
        });
      });

      console.log("AR Business Card initialized");
    </script>
  </body>
</html>
