<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #000;
        overflow: hidden;
      }

      a-scene {
        opacity: 0;
        transition: opacity 1s ease-in-out;
      }

      a-scene.ready {
        opacity: 1;
      }

      #loading-indicator {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        background: linear-gradient(145deg, rgba(0, 20, 40, 0.95), rgba(0, 40, 80, 0.95));
        color: #00ffff;
        padding: 30px;
        border-radius: 15px;
        display: none;
        font-family: 'Courier New', monospace;
        text-align: center;
        border: 2px solid #00ffff;
        box-shadow: 
          0 0 20px rgba(0, 255, 255, 0.3),
          inset 0 0 20px rgba(0, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .loading-text {
        font-size: 16px;
        margin-bottom: 20px;
        text-shadow: 0 0 10px #00ffff;
      }

      .scanner-frame {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        width: 250px;
        height: 250px;
        border: 2px solid #00ffff;
        border-radius: 10px;
        z-index: 1000;
        display: none;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
      }

      .corner {
        position: absolute;
        width: 30px;
        height: 30px;
        border: 3px solid #00ffff;
      }

      .corner.top-left {
        top: -3px;
        left: -3px;
        border-right: none;
        border-bottom: none;
        border-top-left-radius: 10px;
      }

      .corner.top-right {
        top: -3px;
        right: -3px;
        border-left: none;
        border-bottom: none;
        border-top-right-radius: 10px;
      }

      .corner.bottom-left {
        bottom: -3px;
        left: -3px;
        border-right: none;
        border-top: none;
        border-bottom-left-radius: 10px;
      }

      .corner.bottom-right {
        bottom: -3px;
        right: -3px;
        border-left: none;
        border-top: none;
        border-bottom-right-radius: 10px;
      }

      .scan-line {
        position: absolute;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #00ffff, transparent);
        animation: scan 2s linear infinite;
        box-shadow: 0 0 10px #00ffff;
      }

      .loading-dots {
        display: inline-block;
        position: relative;
        width: 60px;
        height: 10px;
      }

      .loading-dots div {
        position: absolute;
        top: 0;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #00ffff;
        animation: loading-dots 1.2s linear infinite;
        box-shadow: 0 0 10px #00ffff;
      }

      .loading-dots div:nth-child(1) { left: 8px; animation-delay: 0s; }
      .loading-dots div:nth-child(2) { left: 26px; animation-delay: -0.4s; }
      .loading-dots div:nth-child(3) { left: 44px; animation-delay: -0.8s; }

      .status-text {
        font-size: 14px;
        color: #00ff88;
        margin-top: 10px;
        text-shadow: 0 0 5px #00ff88;
      }

      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
        z-index: 10000;
        display: block;
      }

      @keyframes scan {
        0% { top: 0; }
        100% { top: 100%; }
      }

      @keyframes loading-dots {
        0%, 80%, 100% { 
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% { 
          transform: scale(1.2);
          opacity: 1;
        }
      }

      @keyframes pulse {
        0%, 100% { 
          box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
          border-color: #00ffff;
        }
        50% { 
          box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
          border-color: #00ff88;
        }
      }

      .corner {
        animation: pulse 2s ease-in-out infinite;
      }
    </style>
  </head>
  <body>
    <div id="overlay"></div>
    
    <div id="loading-indicator">
      <div class="loading-text">AR系統初始化中</div>
      <div class="loading-dots">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="status-text">正在載入目標識別模組...</div>
    </div>

    <div id="scanner-frame" class="scanner-frame">
      <div class="corner top-left"></div>
      <div class="corner top-right"></div>
      <div class="corner bottom-left"></div>
      <div class="corner bottom-right"></div>
      <div class="scan-line"></div>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: https://raw.githubusercontent.com/isaoinvest/name-card/main/KKtargets.mind; warmupTolerance: 5; missTolerance: 600; filterMinCF: 0.000001; filterBeta: 500"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <img
          id="profile"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Big%20Head%20Shot.png"
          crossorigin="anonymous"
        />
        <img
          id="website"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/website.png"
          crossorigin="anonymous"
        />
        <img
          id="Email"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/EMAIL.png"
          crossorigin="anonymous"
        />
        <img
          id="phone"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/phone.png"
          crossorigin="anonymous"
        />
        <img
          id="image-LINE"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Line-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-Youtube"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Youtube-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-IG"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Instagram-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-FB"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Facebook-1.png"
          crossorigin="anonymous"
        />
        <video
          id="video1"
          src="https://pub-ac80c6d0a305452bbe0bdfcec65b6a2c.r2.dev/NEWS.mp4"
          loop
          muted
          playsinline
          crossorigin="anonymous"
          preload="auto"
        ></video>
        <a-asset-item
          id="raccoonModel"
          src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/band-example/raccoon/scene.gltf"
        ></a-asset-item>
      </a-assets>

      <a-camera
        position="0 0 0"
        look-controls="enabled: false"
        cursor="fuse: false; rayOrigin: mouse;"
        raycaster="far: 1000; objects: .clickable"
      ></a-camera>

      <!-- 第一個AR目標 - 名片內容 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity
          text="value: Red Panda Keeper\nMingHsun Li; color: #FFF"
          position="1.2 0.68 -1.5"
          scale="2 2 2"
        ></a-entity>
        
        <a-gltf-model
          rotation="0 0 0"
          position="-0.25 -0.15 0"
          scale="0.09 0.09 0.09"
          src="#raccoonModel"
          animation-mixer
        ></a-gltf-model>
        
        <a-image
          src="#profile"
          width="0.55"
          height="0.55"
          position="0.6 0.9 -1.5"
          rotation="0 0 0"
        ></a-image>
        
        <a-image
          src="#website"
          width="0.65"
          height="0.25"
          position="0.6 0.4 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://isaoinvest.com"
        ></a-image>
        
        <a-image
          src="#Email"
          width="0.65"
          height="0.25"
          position="0.6 0.1 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: mailto:isaoinvest@gmail.com"
        ></a-image>
        
        <a-image
          src="#phone"
          width="0.65"
          height="0.23"
          position="0.6 -0.2 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: tel:+886920820259"
        ></a-image>
        
        <a-image
          src="#image-LINE"
          width="0.3"
          height="0.3"
          position="0.6 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://line.me/R/ti/p/@722fdkca"
        ></a-image>
        
        <a-image
          src="#image-Youtube"
          width="0.3"
          height="0.3"
          position="0.2 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.youtube.com/channel/UC7hJoQaFXoqB-tW4zACOtvQ"
        ></a-image>
        
        <a-image
          src="#image-IG"
          width="0.3"
          height="0.3"
          position="-0.2 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.instagram.com/isaoinvest"
        ></a-image>
        
        <a-image
          src="#image-FB"
          width="0.3"
          height="0.3"
          position="-0.6 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.facebook.com/profile.php?id=61552552833098"
        ></a-image>
      </a-entity>

      <!-- 第二個AR目標 - 影片 -->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-video
          id="ar-video"
          src="#video1"
          height="1.05"
          width="1.5"
          position="0 0 0"
          rotation="0 0 0"
          class="clickable"
          video-handler
        ></a-video>
      </a-entity>
    </a-scene>

    <script>
      // 視頻自動播放控制
      AFRAME.registerComponent("video-handler", {
        init: function () {
          var video = document.querySelector("#video1");
          var scene = this.el.sceneEl;
          var target = this.el.parentEl;
          var isPlaying = false;
          
          console.log("Video handler initialized");
          
          // 監聽目標發現事件
          target.addEventListener("targetFound", () => {
            console.log("Video target found, attempting to play");
            video.currentTime = 0; // 重置到開始
            video.play().then(() => {
              isPlaying = true;
              console.log("Video playing successfully");
            }).catch(error => {
              console.error("Video play failed:", error);
              // 如果自動播放失敗，嘗試靜音播放
              video.muted = true;
              video.play().then(() => {
                isPlaying = true;
                console.log("Video playing muted");
              }).catch(err => {
                console.error("Muted video play also failed:", err);
              });
            });
          });
          
          // 監聽目標丟失事件
          target.addEventListener("targetLost", () => {
            console.log("Video target lost, pausing video");
            video.pause();
            isPlaying = false;
          });
          
          // 點擊控制播放/暫停
          this.el.addEventListener("click", function () {
            console.log("Video clicked, current playing state:", isPlaying);
            if (!isPlaying) {
              video.play().then(() => {
                isPlaying = true;
                console.log("Video resumed by click");
              }).catch(error => {
                console.error("Click play failed:", error);
              });
            } else {
              video.pause();
              isPlaying = false;
              console.log("Video paused by click");
            }
          });
          
          // 監聽影片事件
          video.addEventListener('loadstart', () => console.log('Video load started'));
          video.addEventListener('loadeddata', () => console.log('Video data loaded'));
          video.addEventListener('canplay', () => console.log('Video can play'));
          video.addEventListener('playing', () => console.log('Video is playing'));
          video.addEventListener('pause', () => console.log('Video paused'));
          video.addEventListener('error', (e) => console.error('Video error:', e));
        },
      });

      // 載入指示器邏輯
      const loadingIndicator = document.getElementById("loading-indicator");
      const scannerFrame = document.getElementById("scanner-frame");
      const statusText = document.querySelector(".status-text");
      const overlay = document.getElementById("overlay");
      const scene = document.querySelector("a-scene");
      
      let loadingStep = 0;
      const loadingMessages = [
        "正在載入目標識別模組...",
        "初始化攝影機系統...",
        "準備AR引擎...",
        "系統就緒，請掃描目標"
      ];
      
      document.addEventListener("DOMContentLoaded", () => {
        loadingIndicator.style.display = "block";
        
        // 模擬載入步驟
        const loadingInterval = setInterval(() => {
          if (loadingStep < loadingMessages.length - 1) {
            loadingStep++;
            statusText.textContent = loadingMessages[loadingStep];
          } else {
            clearInterval(loadingInterval);
          }
        }, 800);
      });

      // 等待場景完全載入
      scene.addEventListener("loaded", () => {
        console.log("Scene loaded");
        setTimeout(() => {
          loadingIndicator.style.display = "none";
          overlay.style.display = "none";
          scene.classList.add("ready");
          scannerFrame.style.display = "block";
          
          // 5秒後隱藏掃描框
          setTimeout(() => {
            scannerFrame.style.display = "none";
          }, 5000);
        }, 1500);
      });

      // 添加錯誤處理
      window.addEventListener('error', function(e) {
        console.error('Error:', e.error);
        loadingIndicator.style.display = "none";
      });

      // MindAR 載入狀態監聽
      scene.addEventListener("arReady", () => {
        console.log("AR is ready");
        loadingIndicator.style.display = "none";
        overlay.style.display = "none";
        scene.classList.add("ready");
        scannerFrame.style.display = "block";
        
        // 5秒後隱藏掃描框
        setTimeout(() => {
          scannerFrame.style.display = "none";
        }, 5000);
      });

      scene.addEventListener("arError", (event) => {
        console.error("AR Error:", event.detail);
        loadingIndicator.style.display = "none";
        overlay.style.display = "none";
        scannerFrame.style.display = "none";
      });

      // 點擊元素效果
      const clickableElements = document.querySelectorAll(".clickable");
      clickableElements.forEach((element) => {
        element.addEventListener("mouseenter", () => {
          element.setAttribute("animation", "property: scale; to: 1.1 1.1 1.1; dur: 300");
        });
        element.addEventListener("mouseleave", () => {
          element.setAttribute("animation", "property: scale; to: 1 1 1; dur: 300");
        });
      });

      console.log("AR Business Card initialized");
    </script>
  </body>
</html>
