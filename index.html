<!DOCTYPE html>
<html lang="zh-TW">
<head>
<title>AR Business Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const sceneEl = document.querySelector('a-scene');
  let arSystem;
  
  sceneEl.addEventListener('loaded', function () {
    arSystem = sceneEl.systems["mindar-image-system"];
    console.log("MindAR system loaded");
  });

  // 等待場景載入後設置事件監聽器
  sceneEl.addEventListener("arReady", (event) => {
    console.log("MindAR is ready");
    setupEventListeners();
  });

  sceneEl.addEventListener("arError", (event) => {
    console.log("MindAR failed to start");
  });

  function setupEventListeners() {
    console.log("Setting up event listeners");
    
    // 獲取所有可點擊元素
    const clickableButtons = [
      { id: 'btn-website', url: 'https://isaoinvest.com' },
      { id: 'btn-email', url: 'mailto:isaoinvest@gmail.com' },
      { id: 'btn-phone', url: 'tel:+886920820259' },
      { id: 'btn-line', url: 'https://line.me/R/ti/p/@722fdkca' },
      { id: 'btn-youtube', url: 'https://www.youtube.com/channel/UC7hJoQaFXoqB-tW4zACOtvQ' },
      { id: 'btn-ig', url: 'https://www.instagram.com/isaoinvest' },
      { id: 'btn-fb', url: 'https://www.facebook.com/profile.php?id=61552552833098' }
    ];

    clickableButtons.forEach(button => {
      const element = document.querySelector('#' + button.id);
      if (element) {
        console.log('Setting up click for:', button.id);
        element.addEventListener("click", event => {
          console.log("Button clicked:", button.id, "URL:", button.url);
          try {
            if (button.url.startsWith('mailto:') || button.url.startsWith('tel:')) {
              window.location.href = button.url;
            } else {
              window.open(button.url, '_blank');
            }
          } catch (error) {
            console.error('Error opening URL:', error);
          }
        });

        // 懸停效果
        element.addEventListener("mouseenter", () => {
          if (element.object3D) {
            gsap.to(element.object3D.scale, {
              x: 1.4, y: 1.4, z: 1.4, duration: 0.3
            });
          }
        });

        element.addEventListener("mouseleave", () => {
          if (element.object3D) {
            gsap.to(element.object3D.scale, {
              x: 1, y: 1, z: 1, duration: 0.3
            });
          }
        });
      } else {
        console.log('Button not found:', button.id);
      }
    });

    // 視頻點擊處理
    const video = document.querySelector("#video1");
    const videoElement = document.querySelector("#ar-video");
    const videoTarget = document.querySelector("#video-target");
    let playing = false;
    let hasInteracted = false;

    if (videoElement) {
      videoElement.addEventListener("click", event => {
        console.log("Video clicked, playing:", playing);
        
        if (!hasInteracted) {
          video.muted = false;
          hasInteracted = true;
          console.log("Video unmuted after user interaction");
        }
        
        if (!playing) {
          video.play();
          console.log("Video playing");
        } else {
          video.pause();
          console.log("Video paused");
        }
        playing = !playing;
      });
    }

    // 目標發現/丟失事件
    if (videoTarget) {
      videoTarget.addEventListener("targetFound", event => {
        console.log("Video target found");
        video.currentTime = 0;
        
        if (!hasInteracted) {
          video.muted = true;
          video.play().then(() => {
            playing = true;
            console.log("Video auto-playing (muted)");
          }).catch(error => {
            console.error("Auto-play failed:", error);
          });
        }
      });

      videoTarget.addEventListener("targetLost", event => {
        console.log("Video target lost, pausing video");
        video.pause();
        playing = false;
      });
    }

    // 浣熊模型動畫 - 簡化設置，讓animation-mixer處理內建動畫
    const raccoonModel = document.querySelector("#raccoon-model");
    if (raccoonModel) {
      console.log("Raccoon model found, animation-mixer should handle built-in animations");
      
      // 檢查模型載入狀態
      raccoonModel.addEventListener("model-loaded", () => {
        console.log("Raccoon model loaded successfully - animations should be playing");
      });
      
      // 可選：添加額外的浮動效果
      raccoonModel.addEventListener("model-loaded", () => {
        console.log("Adding extra floating animation to raccoon");
        if (raccoonModel.object3D) {
          gsap.to(raccoonModel.object3D.position, {
            y: raccoonModel.object3D.position.y + 0.05,
            duration: 3,
            yoyo: true,
            repeat: -1,
            ease: "power1.inOut",
          });
        }
      });
    } else {
      console.log("Raccoon model element not found");
    }
  }

  function startRaccoonAnimation(raccoonModel) {
    // 這個函數現在不需要了，因為animation-mixer會自動處理
    console.log("animation-mixer will handle the built-in drum animation automatically");
  }
  }
});
</script>
<style>
body {
  margin: 0;
  padding: 0;
  background-color: #000;
  overflow: hidden;
}
</style>
</head>
<body>
<a-scene
  mindar-image="imageTargetSrc: https://raw.githubusercontent.com/isaoinvest/name-card/main/KKtargets.mind; warmupTolerance: 5; missTolerance: 600; filterMinCF: 0.000001; filterBeta: 500"
  color-space="sRGB"
  renderer="colorManagement: true, physicallyCorrectLights"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
>
  <a-assets>
    <img id="profile" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Big%20Head%20Shot.png" crossorigin="anonymous" alt="Profile Photo" />
    <img id="website" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/website2.png" crossorigin="anonymous" alt="Website Button" />
    <img id="Email" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/EMAIL2.png" crossorigin="anonymous" alt="Email Button" />
    <img id="phone" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/phone2.png" crossorigin="anonymous" alt="Phone Button" />
    <img id="image-LINE" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Line-1.png" crossorigin="anonymous" alt="LINE Button" />
    <img id="image-Youtube" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Youtube-1.png" crossorigin="anonymous" alt="YouTube Button" />
    <img id="image-IG" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Instagram-1.png" crossorigin="anonymous" alt="Instagram Button" />
    <img id="image-FB" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Facebook-1.png" crossorigin="anonymous" alt="Facebook Button" />
    <video id="video1" src="https://pub-ac80c6d0a305452bbe0bdfcec65b6a2c.r2.dev/NEWS.mp4" loop playsinline crossorigin="anonymous" preload="auto"></video>
    <a-asset-item id="raccoonModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/band-example/raccoon/scene.gltf"></a-asset-item>
  </a-assets>

  <!-- 按照官方文檔的確切配置 -->
  <a-camera 
    position="0 0 0" 
    look-controls="enabled: false" 
    cursor="fuse: false; rayOrigin: mouse;" 
    raycaster="near: 10; far: 10000; objects: .clickable">
  </a-camera>

  <a-entity mindar-image-target="targetIndex: 0">
    <a-entity
      text="value: Red Panda Keeper\nMingHsun Li; color: #FFF"
      position="1.2 0.68 -1.5"
      scale="2 2 2"
    ></a-entity>
    
    <a-gltf-model
      id="raccoon-model"
      rotation="0 0 0"
      position="-0.25 -0.15 0"
      scale="0.09 0.09 0.09"
      src="#raccoonModel"
      animation-mixer
    ></a-gltf-model>
    
    <a-image
      src="#profile"
      width="0.55"
      height="0.55"
      position="0.6 0.9 -1.5"
      rotation="0 0 0"
    ></a-image>
    
    <!-- 按照官方格式設置可點擊元素 -->
    <a-image
      id="btn-website"
      src="#website"
      width="0.65"
      height="0.25"
      position="0.6 0.4 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
    
    <a-image
      id="btn-email"
      src="#Email"
      width="0.65"
      height="0.25"
      position="0.6 0.1 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
    
    <a-image
      id="btn-phone"
      src="#phone"
      width="0.65"
      height="0.23"
      position="0.6 -0.2 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
    
    <a-image
      id="btn-line"
      src="#image-LINE"
      width="0.3"
      height="0.3"
      position="0.6 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
    
    <a-image
      id="btn-youtube"
      src="#image-Youtube"
      width="0.3"
      height="0.3"
      position="0.2 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
    
    <a-image
      id="btn-ig"
      src="#image-IG"
      width="0.3"
      height="0.3"
      position="-0.2 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
    
    <a-image
      id="btn-fb"
      src="#image-FB"
      width="0.3"
      height="0.3"
      position="-0.6 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-image>
  </a-entity>

  <a-entity id="video-target" mindar-image-target="targetIndex: 1">
    <a-video
      id="ar-video"
      src="#video1"
      height="1.05"
      width="1.5"
      position="0 0 0"
      rotation="0 0 0"
      class="clickable"
      opacity="1"
    ></a-video>
  </a-entity>
</a-scene>
</body>
</html>
