<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<style>
body {
  margin: 0;
  padding: 0;
  background-color: #000;
  overflow: hidden;
}

a-scene {
  opacity: 1;
  transition: opacity 0.5s ease-in-out;
}

/* 简化的UI遮蔽层处理 - 不影响点击 */
.mindar-ui-loading {
  background: rgba(0, 0, 0, 0.5) !important;
  color: #fff !important;
}

.mindar-ui-scanning {
  border: 1px solid #fff !important;
}
</style>
</head>
<body>
<a-scene
  mindar-image="imageTargetSrc: https://raw.githubusercontent.com/isaoinvest/name-card/main/KKtargets.mind; warmupTolerance: 5; missTolerance: 600; filterMinCF: 0.000001; filterBeta: 500; showStats: false"
  color-space="sRGB"
  renderer="colorManagement: true, physicallyCorrectLights"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
>
  <a-assets>
    <img id="profile" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Big%20Head%20Shot.png" crossorigin="anonymous" />
    <img id="website" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/website2.png" crossorigin="anonymous" />
    <img id="Email" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/EMAIL2.png" crossorigin="anonymous" />
    <img id="phone" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/phone2.png" crossorigin="anonymous" />
    <img id="image-LINE" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Line-1.png" crossorigin="anonymous" />
    <img id="image-Youtube" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Youtube-1.png" crossorigin="anonymous" />
    <img id="image-IG" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Instagram-1.png" crossorigin="anonymous" />
    <img id="image-FB" src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Facebook-1.png" crossorigin="anonymous" />
    <video id="video1" src="https://pub-ac80c6d0a305452bbe0bdfcec65b6a2c.r2.dev/NEWS.mp4" loop playsinline crossorigin="anonymous" preload="auto"></video>
    <a-asset-item id="raccoonModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/band-example/raccoon/scene.gltf"></a-asset-item>
  </a-assets>

  <!-- 恢复A-Frame原生的相机设置 - 这是点击功能的关键 -->
  <a-camera
    position="0 0 0"
    look-controls="enabled: false"
    cursor="fuse: false; rayOrigin: mouse;"
    raycaster="far: 1000; objects: .clickable"
  ></a-camera>

  <a-entity mindar-image-target="targetIndex: 0">
    <a-entity
      text="value: Red Panda Keeper\nMingHsun Li; color: #FFF"
      position="1.2 0.68 -1.5"
      scale="2 2 2"
    ></a-entity>
    
    <a-gltf-model
      rotation="0 0 0"
      position="-0.25 -0.15 0"
      scale="0.09 0.09 0.09"
      src="#raccoonModel"
      animation-mixer
    ></a-gltf-model>
    
    <a-image
      src="#profile"
      width="0.55"
      height="0.55"
      position="0.6 0.9 -1.5"
      rotation="0 0 0"
    ></a-image>
    
    <!-- 使用旧代码的成功点击逻辑 -->
    <a-image
      src="#website"
      width="0.65"
      height="0.25"
      position="0.6 0.4 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: https://isaoinvest.com"
    ></a-image>
    
    <a-image
      src="#Email"
      width="0.65"
      height="0.25"
      position="0.6 0.1 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: mailto:isaoinvest@gmail.com"
    ></a-image>
    
    <a-image
      src="#phone"
      width="0.65"
      height="0.23"
      position="0.6 -0.2 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: tel:+886920820259"
    ></a-image>
    
    <a-image
      src="#image-LINE"
      width="0.3"
      height="0.3"
      position="0.6 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: https://line.me/R/ti/p/@722fdkca"
    ></a-image>
    
    <a-image
      src="#image-Youtube"
      width="0.3"
      height="0.3"
      position="0.2 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: https://www.youtube.com/channel/UC7hJoQaFXoqB-tW4zACOtvQ"
    ></a-image>
    
    <a-image
      src="#image-IG"
      width="0.3"
      height="0.3"
      position="-0.2 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: https://www.instagram.com/isaoinvest"
    ></a-image>
    
    <a-image
      src="#image-FB"
      width="0.3"
      height="0.3"
      position="-0.6 -0.65 -1.5"
      rotation="0 0 0"
      class="clickable"
      link="href: https://www.facebook.com/profile.php?id=61552552833098"
    ></a-image>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 1">
    <a-video
      id="ar-video"
      src="#video1"
      height="1.05"
      width="1.5"
      position="0 0 0"
      rotation="0 0 0"
      class="clickable"
      click-handler1
    ></a-video>
  </a-entity>
</a-scene>

<script>
// 使用旧代码的成功视频处理逻辑
AFRAME.registerComponent("click-handler1", {
  init: function () {
    var video = document.querySelector("#video1");
    var playing = false;
    var target = this.el.parentEl;
    
    console.log("Video handler initialized");
    
    // 点击播放/暂停
    this.el.addEventListener("click", function () {
      console.log("Video clicked, playing:", playing);
      if (!playing) {
        video.play();
      } else {
        video.pause();
      }
      playing = !playing;
    });
    
    // 目标发现时自动播放
    target.addEventListener("targetFound", () => {
      console.log("Video target found, attempting to play");
      video.currentTime = 0;
      
      const playVideo = async () => {
        try {
          video.muted = true;
          await video.play();
          playing = true;
          console.log("Video playing");
        } catch (error) {
          console.error("Video play failed:", error);
        }
      };
      
      playVideo();
    });
    
    // 目标丢失时暂停
    target.addEventListener("targetLost", () => {
      console.log("Video target lost, pausing video");
      video.pause();
      playing = false;
    });
  },
});

// 使用旧代码的GSAP动画逻辑
const raccoonModel = document.querySelector("a-gltf-model");
if (raccoonModel) {
  raccoonModel.addEventListener("loaded", () => {
    gsap.to(raccoonModel.object3D.position, {
      y: "+=0.1",
      duration: 2,
      yoyo: true,
      repeat: -1,
      ease: "power1.inOut",
    });
  });
}

// 使用旧代码的悬停效果逻辑
const clickableElements = document.querySelectorAll(".clickable");
clickableElements.forEach((element) => {
  element.addEventListener("mouseenter", () => {
    gsap.to(element.object3D.scale, {
      x: 1.4,
      y: 1.4,
      z: 1.4,
      duration: 0.3,
    });
  });
  element.addEventListener("mouseleave", () => {
    gsap.to(element.object3D.scale, { x: 1, y: 1, z: 1, duration: 0.3 });
  });
});

// 场景载入处理
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded');
  
  const scene = document.querySelector('a-scene');
  if (scene) {
    scene.addEventListener('loaded', function() {
      console.log('A-Frame scene loaded with clickable elements');
    });
  }
});

// 调试点击事件
document.addEventListener('click', function(event) {
  console.log('Global click detected at:', event.clientX, event.clientY);
  console.log('Target element:', event.target);
});

console.log("AR Business Card system initialized with working click functionality");
</script>
</body>
</html>
