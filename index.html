<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #000;
        overflow: hidden;
      }

      a-scene {
        opacity: 0;
        transition: opacity 1s ease-in-out;
      }

      a-scene.ready {
        opacity: 1;
      }

      #loading-indicator {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        background: linear-gradient(145deg, rgba(0, 20, 40, 0.95), rgba(0, 40, 80, 0.95));
        color: #00ffff;
        padding: 30px;
        border-radius: 15px;
        display: none;
        font-family: 'Courier New', monospace;
        text-align: center;
        border: 2px solid #00ffff;
        box-shadow: 
          0 0 20px rgba(0, 255, 255, 0.3),
          inset 0 0 20px rgba(0, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .loading-text {
        font-size: 16px;
        margin-bottom: 20px;
        text-shadow: 0 0 10px #00ffff;
      }

      .scanner-frame {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        width: 250px;
        height: 250px;
        border: 2px solid #00ffff;
        border-radius: 10px;
        z-index: 1000;
        display: block;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        opacity: 1;
        transition: opacity 0.3s ease;
      }

      .scanner-frame.hidden {
        opacity: 0;
      }

      .corner {
        position: absolute;
        width: 30px;
        height: 30px;
        border: 3px solid #00ffff;
        animation: pulse 2s ease-in-out infinite;
      }

      .corner.top-left {
        top: -3px;
        left: -3px;
        border-right: none;
        border-bottom: none;
        border-top-left-radius: 10px;
      }

      .corner.top-right {
        top: -3px;
        right: -3px;
        border-left: none;
        border-bottom: none;
        border-top-right-radius: 10px;
      }

      .corner.bottom-left {
        bottom: -3px;
        left: -3px;
        border-right: none;
        border-top: none;
        border-bottom-left-radius: 10px;
      }

      .corner.bottom-right {
        bottom: -3px;
        right: -3px;
        border-left: none;
        border-top: none;
        border-bottom-right-radius: 10px;
      }

      .scan-line {
        position: absolute;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #00ffff, transparent);
        animation: scan 2s linear infinite;
        box-shadow: 0 0 10px #00ffff;
      }

      .loading-dots {
        display: inline-block;
        position: relative;
        width: 60px;
        height: 10px;
      }

      .loading-dots div {
        position: absolute;
        top: 0;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #00ffff;
        animation: loading-dots 1.2s linear infinite;
        box-shadow: 0 0 10px #00ffff;
      }

      .loading-dots div:nth-child(1) { left: 8px; animation-delay: 0s; }
      .loading-dots div:nth-child(2) { left: 26px; animation-delay: -0.4s; }
      .loading-dots div:nth-child(3) { left: 44px; animation-delay: -0.8s; }

      .status-text {
        font-size: 14px;
        color: #00ff88;
        margin-top: 10px;
        text-shadow: 0 0 5px #00ff88;
      }

      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
        z-index: 10000;
        display: block;
      }

      @keyframes scan {
        0% { top: 0; }
        100% { top: 100%; }
      }

      @keyframes loading-dots {
        0%, 80%, 100% { 
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% { 
          transform: scale(1.2);
          opacity: 1;
        }
      }

      @keyframes pulse {
        0%, 100% { 
          box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
          border-color: #00ffff;
        }
        50% { 
          box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
          border-color: #00ff88;
        }
      }
    </style>
  </head>
  <body>
    <div id="overlay"></div>
    
    <div id="loading-indicator">
      <div class="loading-text">AR系統初始化中</div>
      <div class="loading-dots">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="status-text">正在載入目標識別模組...</div>
    </div>

    <div id="scanner-frame" class="scanner-frame">
      <div class="corner top-left"></div>
      <div class="corner top-right"></div>
      <div class="corner bottom-left"></div>
      <div class="corner bottom-right"></div>
      <div class="scan-line"></div>
      <div style="position: absolute; bottom: -40px; left: 50%; transform: translateX(-50%); color: #00ffff; font-family: 'Courier New', monospace; font-size: 14px; text-shadow: 0 0 10px #00ffff;">掃描目標中...</div>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: https://raw.githubusercontent.com/isaoinvest/name-card/main/KKtargets.mind; warmupTolerance: 5; missTolerance: 600; filterMinCF: 0.000001; filterBeta: 500; showStats: false; showLoading: false; uiScanning: #scanner-frame"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      loading-screen="enabled: false"
    >
      <a-assets>
        <img
          id="profile"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Big%20Head%20Shot.png"
          crossorigin="anonymous"
        />
        <img
          id="website"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/website2.png"
          crossorigin="anonymous"
        />
        <img
          id="Email"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/EMAIL2.png"
          crossorigin="anonymous"
        />
        <img
          id="phone"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/phone2.png"
          crossorigin="anonymous"
        />
        <img
          id="image-LINE"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Line-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-Youtube"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Youtube-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-IG"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Instagram-1.png"
          crossorigin="anonymous"
        />
        <img
          id="image-FB"
          src="https://raw.githubusercontent.com/isaoinvest/name-card/main/Facebook-1.png"
          crossorigin="anonymous"
        />
        <video
          id="video1"
          src="https://pub-ac80c6d0a305452bbe0bdfcec65b6a2c.r2.dev/NEWS.mp4"
          loop
          playsinline
          crossorigin="anonymous"
          preload="auto"
        ></video>
        <a-asset-item
          id="raccoonModel"
          src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/band-example/raccoon/scene.gltf"
        ></a-asset-item>
      </a-assets>

      <a-camera
        position="0 0 0"
        look-controls="enabled: false"
        cursor="fuse: false; rayOrigin: mouse;"
        raycaster="far: 1000; objects: .clickable"
      ></a-camera>

      <!-- 第一個AR目標 - 名片內容 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity
          text="value: Red Panda Keeper\nMingHsun Li; color: #FFF"
          position="1.2 0.68 -1.5"
          scale="2 2 2"
        ></a-entity>
        
        <a-gltf-model
          rotation="0 0 0"
          position="-0.25 -0.15 0"
          scale="0.09 0.09 0.09"
          src="#raccoonModel"
          animation-mixer
        ></a-gltf-model>
        
        <a-image
          src="#profile"
          width="0.55"
          height="0.55"
          position="0.6 0.9 -1.5"
          rotation="0 0 0"
        ></a-image>
        
        <a-image
          src="#website"
          width="0.65"
          height="0.25"
          position="0.6 0.4 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://isaoinvest.com"
          data-link="https://isaoinvest.com"
          click-handler
        ></a-image>
        
        <a-image
          src="#Email"
          width="0.65"
          height="0.25"
          position="0.6 0.1 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: mailto:isaoinvest@gmail.com"
          data-link="mailto:isaoinvest@gmail.com"
          click-handler
        ></a-image>
        
        <a-image
          src="#phone"
          width="0.65"
          height="0.23"
          position="0.6 -0.2 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: tel:+886920820259"
          data-link="tel:+886920820259"
          click-handler
        ></a-image>
        
        <a-image
          src="#image LINE"
          width="0.3"
          height="0.3"
          position="0.6 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://line.me/R/ti/p/@722fdkca"
          data-link="https://line.me/R/ti/p/@722fdkca"
          click-handler
        ></a-image>
        
        <a-image
          src="#image Youtube"
          width="0.3"
          height="0.3"
          position="0.2 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.youtube.com/channel/UC7hJoQaFXoqB-tW4zACOtvQ"
          data-link="https://www.youtube.com/channel/UC7hJoQaFXoqB-tW4zACOtvQ"
          click-handler
        ></a-image>
        
        <a-image
          src="#image IG"
          width="0.3"
          height="0.3"
          position="-0.2 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.instagram.com/isaoinvest"
          data-link="https://www.instagram.com/isaoinvest"
          click-handler
        ></a-image>
        
        <a-image
          src="#image FB"
          width="0.3"
          height="0.3"
          position="-0.6 -0.65 -1.5"
          rotation="0 0 0"
          class="clickable"
          link="href: https://www.facebook.com/profile.php?id=61552552833098"
          data-link="https://www.facebook.com/profile.php?id=61552552833098"
          click-handler
        ></a-image>
      </a-entity>

      <!-- 第二個AR目標 - 影片 -->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-video
          id="ar-video"
          src="#video1"
          height="1.05"
          width="1.5"
          position="0 0 0"
          rotation="0 0 0"
          class="clickable"
          video-handler
        ></a-video>
      </a-entity>
    </a-scene>

    <script>
      // 通用點擊處理器組件
      AFRAME.registerComponent('click-handler', {
        init: function () {
          const el = this.el;
          
          // 使用簡單的點擊事件監聽器
          el.addEventListener('click', (event) => {
            console.log('Element clicked:', el);
            
            // 首先嘗試從 data-link 屬性獲取連結
            const dataLink = el.getAttribute('data-link');
            if (dataLink) {
              console.log('Opening data-link:', dataLink);
              window.open(dataLink, '_blank');
              return;
            }
            
            // 如果沒有 data-link，嘗試從 link 組件獲取
            const linkComponent = el.getAttribute('link');
            if (linkComponent && linkComponent.href) {
              console.log('Opening link href:', linkComponent.href);
              window.open(linkComponent.href, '_blank');
              return;
            }
            
            console.log('No valid link found for element');
          });
          
          // 添加懸停效果
          el.addEventListener('mouseenter', () => {
            if (window.gsap) {
              gsap.to(el.object3D.scale, {
                x: 1.2,
                y: 1.2,
                z: 1.2,
                duration: 0.3,
              });
            }
          });
          
          el.addEventListener('mouseleave', () => {
            if (window.gsap) {
              gsap.to(el.object3D.scale, {
                x: 1,
                y: 1,
                z: 1,
                duration: 0.3,
              });
            }
          });
        }
      });

      AFRAME.registerComponent("click-handler1", {
        init: function () {
          var video = document.querySelector("#video1");
          var playing = false;
          this.el.addEventListener("click", function () {
            if (!playing) {
              video.play();
            } else {
              video.pause();
            }
            playing = !playing;
          });
        },
      });

      // MP3 撥放按鈕
      const mp3Button = document.getElementById("play-mp3");
      const mp3Sound = document.getElementById("mp3-sound");

      mp3Button.addEventListener("click", () => {
        mp3Sound.play();
      });

      // Loading indicator logic
      const loadingIndicator = document.getElementById("loading-indicator");
      document.addEventListener("DOMContentLoaded", () => {
        loadingIndicator.style.display = "block";
      });

      document.querySelector("a-scene").addEventListener("loaded", () => {
        loadingIndicator.style.display = "none";
      });

      // GSAP animation for 3D model
      const raccoonModel = document.querySelector("a-gltf-model");
      if (raccoonModel) {
        raccoonModel.addEventListener("loaded", () => {
          gsap.to(raccoonModel.object3D.position, {
            y: "+=0.1",
            duration: 2,
            yoyo: true,
            repeat: -1,
            ease: "power1.inOut",
          });
        });
      }

      // 移除舊的懸停效果處理器，因為現在在 click-handler 組件中處理
      
      // Frame control logic
      const videoFrame = document.querySelector("#video-frame");
      const toggleFrameBtn = document.querySelector("#toggle-frame");
      const blackFrameBtn = document.querySelector("#black-frame");
      const woodFrameBtn = document.querySelector("#wood-frame");
      const goldFrameBtn = document.querySelector("#gold-frame");
      const redFrameBtn = document.querySelector("#red-frame");

      function setFrameColor(color) {
        const frameParts = videoFrame.querySelectorAll("a-box");
        frameParts.forEach((part) => {
          part.setAttribute("color", color);
          part.removeAttribute("material");
        });
      }

      function setFrameTexture(textureId) {
        const frameParts = videoFrame.querySelectorAll("a-box");
        frameParts.forEach((part) => {
          part.setAttribute("material", `src: #${textureId}`);
          part.removeAttribute("color");
        });
      }

      let frameVisible = true;
      toggleFrameBtn.addEventListener("click", () => {
        frameVisible = !frameVisible;
        videoFrame.setAttribute("visible", frameVisible);
        toggleFrameBtn.textContent = frameVisible ? "隱藏框架" : "顯示框架";
        console.log("Frame visibility toggled:", frameVisible);
      });

      blackFrameBtn.addEventListener("click", () => setFrameColor("#000000"));
      woodFrameBtn.addEventListener("click", () =>
        setFrameTexture("frame-texture-wood")
      );
      goldFrameBtn.addEventListener("click", () =>
        setFrameTexture("frame-texture-gold")
      );
      redFrameBtn.addEventListener("click", () => setFrameColor("#FF0000"));

      // Debug logging
      console.log("Frame controls initialized");
      console.log("Toggle button:", toggleFrameBtn);
      console.log("Black button:", blackFrameBtn);
      console.log("Wood button:", woodFrameBtn);
      console.log("Gold button:", goldFrameBtn);
      console.log("Red button:", redFrameBtn);

      // 調試用的點擊事件監聽器
      const imageclick = document.querySelector("#image FB");
      if (imageclick) {
        imageclick.addEventListener("click", (event) => {
          console.log("FB image clicked directly");
        });
      }
    </script>
  </body>
</html>
